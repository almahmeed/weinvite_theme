/*! For license information please see firebase-auth.js.LICENSE.txt */
(()=>{"use strict";function e(){var n,r,i="function"==typeof Symbol?Symbol:{},o=i.iterator||"@@iterator",a=i.toStringTag||"@@toStringTag";function u(e,i,o,a){var u=i&&i.prototype instanceof c?i:c,f=Object.create(u.prototype);return t(f,"_invoke",function(e,t,i){var o,a,u,c=0,f=i||[],h=!1,p={p:0,n:0,v:n,a:d,f:d.bind(n,4),d:function(e,t){return o=e,a=0,u=n,p.n=t,s}};function d(e,t){for(a=e,u=t,r=0;!h&&c&&!i&&r<f.length;r++){var i,o=f[r],d=p.p,l=o[2];e>3?(i=l===t)&&(u=o[(a=o[4])?5:(a=3,3)],o[4]=o[5]=n):o[0]<=d&&((i=e<2&&d<o[1])?(a=0,p.v=t,p.n=o[1]):d<l&&(i=e<3||o[0]>t||t>l)&&(o[4]=e,o[5]=t,p.n=l,a=0))}if(i||e>1)return s;throw h=!0,t}return function(i,f,l){if(c>1)throw TypeError("Generator is already running");for(h&&1===f&&d(f,l),a=f,u=l;(r=a<2?n:u)||!h;){o||(a?a<3?(a>1&&(p.n=-1),d(a,u)):p.n=u:p.v=u);try{if(c=2,o){if(a||(i="next"),r=o[i]){if(!(r=r.call(o,u)))throw TypeError("iterator result is not an object");if(!r.done)return r;u=r.value,a<2&&(a=0)}else 1===a&&(r=o.return)&&r.call(o),a<2&&(u=TypeError("The iterator does not provide a '"+i+"' method"),a=1);o=n}else if((r=(h=p.n<0)?u:e.call(t,p))!==s)break}catch(e){o=n,a=1,u=e}finally{c=1}}return{value:r,done:h}}}(e,o,a),!0),f}var s={};function c(){}function f(){}function h(){}r=Object.getPrototypeOf;var p=[][o]?r(r([][o]())):(t(r={},o,function(){return this}),r),d=h.prototype=c.prototype=Object.create(p);function l(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,h):(e.__proto__=h,t(e,a,"GeneratorFunction")),e.prototype=Object.create(d),e}return f.prototype=h,t(d,"constructor",h),t(h,"constructor",f),f.displayName="GeneratorFunction",t(h,a,"GeneratorFunction"),t(d),t(d,a,"Generator"),t(d,o,function(){return this}),t(d,"toString",function(){return"[object Generator]"}),(e=function(){return{w:u,m:l}})()}function t(e,n,r,i){var o=Object.defineProperty;try{o({},"",{})}catch(e){o=0}t=function(e,n,r,i){function a(n,r){t(e,n,function(e){return this._invoke(n,r,e)})}n?o?o(e,n,{value:r,enumerable:!i,configurable:!i,writable:!i}):e[n]=r:(a("next",0),a("throw",1),a("return",2))},t(e,n,r,i)}function n(e,t,n,r,i,o,a){try{var u=e[o](a),s=u.value}catch(e){return void n(e)}u.done?t(s):Promise.resolve(s).then(r,i)}function r(e){return function(){var t=this,r=arguments;return new Promise(function(i,o){var a=e.apply(t,r);function u(e){n(a,i,o,u,s,"next",e)}function s(e){n(a,i,o,u,s,"throw",e)}u(void 0)})}}var i,o,a,u,s,c,f={firebaseConfig:null,firebaseApp:null,init:function(){"undefined"!=typeof weinviteData&&weinviteData.firebaseConfig&&(this.firebaseConfig=weinviteData.firebaseConfig,"undefined"!=typeof firebase&&(this.firebaseApp=firebase.initializeApp(this.firebaseConfig),firebase.auth().onAuthStateChanged(this.onAuthStateChanged.bind(this))))},onAuthStateChanged:function(e){e?this.onUserSignedIn(e):this.onUserSignedOut()},onUserSignedIn:(c=r(e().m(function t(n){var r;return e().w(function(e){for(;;)switch(e.p=e.n){case 0:return e.p=0,e.n=1,n.getIdToken();case 1:return r=e.v,sessionStorage.setItem("idToken",r),sessionStorage.setItem("phoneNumber",n.phoneNumber),e.n=2,this.authenticateWithBackend(r,n.phoneNumber);case 2:this.updateUI(!0,n),e.n=4;break;case 3:e.p=3,e.v;case 4:return e.a(2)}},t,this,[[0,3]])})),function(e){return c.apply(this,arguments)}),onUserSignedOut:function(){sessionStorage.removeItem("idToken"),sessionStorage.removeItem("phoneNumber"),sessionStorage.removeItem("userData"),this.updateUI(!1),this.isProtectedPage()&&(window.location.href=weinviteData.loginUrl)},authenticateWithBackend:(s=r(e().m(function t(n,r){var i,o,a;return e().w(function(e){for(;;)switch(e.p=e.n){case 0:return e.p=0,e.n=1,fetch(weinviteData.apiUrl+"/auth-firebase",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({idToken:n,phone:r.replace(/\D/g,"")})});case 1:return i=e.v,e.n=2,i.json();case 2:(o=e.v).success&&(sessionStorage.setItem("userData",JSON.stringify(o.user)),a=new CustomEvent("weinvite:auth:success",{detail:{user:o.user}}),document.dispatchEvent(a)),e.n=4;break;case 3:e.p=3,e.v;case 4:return e.a(2)}},t,null,[[0,3]])})),function(e,t){return s.apply(this,arguments)}),signInWithPhone:(u=r(e().m(function t(n,r){var i;return e().w(function(e){for(;;)switch(e.p=e.n){case 0:return e.p=0,e.n=1,firebase.auth().signInWithPhoneNumber(n,r);case 1:return i=e.v,e.a(2,i);case 2:throw e.p=2,e.v;case 3:return e.a(2)}},t,null,[[0,2]])})),function(e,t){return u.apply(this,arguments)}),verifyCode:(a=r(e().m(function t(n,r){var i;return e().w(function(e){for(;;)switch(e.p=e.n){case 0:return e.p=0,e.n=1,n.confirm(r);case 1:return i=e.v,e.a(2,i.user);case 2:throw e.p=2,e.v;case 3:return e.a(2)}},t,null,[[0,2]])})),function(e,t){return a.apply(this,arguments)}),signOut:(o=r(e().m(function t(){return e().w(function(e){for(;;)switch(e.p=e.n){case 0:return e.p=0,e.n=1,firebase.auth().signOut();case 1:sessionStorage.clear(),window.location.href=weinviteData.loginUrl,e.n=3;break;case 2:e.p=2,e.v;case 3:return e.a(2)}},t,null,[[0,2]])})),function(){return o.apply(this,arguments)}),getCurrentIdToken:(i=r(e().m(function t(){var n;return e().w(function(e){for(;;)switch(e.n){case 0:if(!(n=firebase.auth().currentUser)){e.n=2;break}return e.n=1,n.getIdToken();case 1:return e.a(2,e.v);case 2:return e.a(2,sessionStorage.getItem("idToken"))}},t)})),function(){return i.apply(this,arguments)}),getCurrentUser:function(){return firebase.auth().currentUser},updateUI:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;if(e){$(".auth-required").show(),$(".auth-hidden").hide(),t&&($(".user-name").text(t.displayName||t.phoneNumber),$(".user-phone").text(t.phoneNumber));var n=sessionStorage.getItem("userData");if(n){var r=JSON.parse(n);$(".user-name").text(r.name||r.phone),void 0!==r.credits&&$(".credit-amount").text(r.credits)}}else $(".auth-required").hide(),$(".auth-hidden").show()},isProtectedPage:function(){var e=window.location.pathname;return["/dashboard","/profile","/my-events","/create-event"].some(function(t){return e.includes(t)})}};document.addEventListener("DOMContentLoaded",function(){f.init()}),window.WeInviteAuth=f})();